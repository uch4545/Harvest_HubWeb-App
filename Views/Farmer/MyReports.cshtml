@using Harvest_Hub.ViewModels;
@model IEnumerable<ReportViewModel>

@{
    ViewData["Title"] = "My Reports";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2 class="text-2xl font-bold mb-4 text-yellow-700">My Reports</h2>

<a asp-action="UploadReport"
   class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded shadow">
    + Upload Report
</a>

<div class="overflow-x-auto mt-6">
    <table class="min-w-full border border-gray-200 bg-white rounded shadow">
        <thead class="bg-gray-100 text-gray-700">
            <tr>
                <th class="px-4 py-2 text-left">Crop</th>
                <th class="px-4 py-2 text-left">Lab</th>
                <th class="px-4 py-2 text-left">File</th>
                <th class="px-4 py-2 text-left">Submitted</th>
                <th class="px-4 py-2 text-left">Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr class="border-b hover:bg-gray-50 transition">
                    <td class="px-4 py-2">@item.Crop?.Name</td>
                    <td class="px-4 py-2">@item.Laboratory?.LabName</td>

                    <td class="px-4 py-2">
                        @if (!string.IsNullOrEmpty(item.Report.ReportFilePath))
                        {
                            <a href="@item.Report.ReportFilePath" target="_blank"
                               class="text-blue-600 hover:text-blue-800 underline">View</a>
                        }
                        else
                        {
                            <span class="text-gray-400">No File</span>
                        }
                    </td>
                    <td class="px-4 py-2">@item.Report.SubmittedAt.ToString("g")</td>
                    @*<td class="px-4 py-2 space-x-2">
            <a asp-action="EditReport" asp-route-id="@item.Report.Id"
               class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded">
                Edit
            </a>
            <form asp-action="DeleteReport" asp-route-id="@item.Report.Id" method="post"
                  class="inline delete-form" data-crop="@item.Crop?.Name">
                <button type="submit"
                        class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded">
                    Delete
                </button>
            </form>
        </td>*@
                </tr>
            }
        </tbody>
    </table>
</div>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll(".delete-form").forEach(form => {
                form.addEventListener("submit", function (e) {
                    e.preventDefault();
                    const crop = form.getAttribute("data-crop") || "this crop";

                    Swal.fire({
                        title: "Delete Report?",
                        text: `Are you sure you want to delete report for "${crop}"?`,
                        icon: "warning",
                        showCancelButton: true,
                        confirmButtonColor: "#d33",
                        cancelButtonColor: "#3085d6",
                        confirmButtonText: "Yes, delete it!"
                    }).then((result) => {
                        if (result.isConfirmed) {
                            form.submit();
                        }
                    });
                });
            });
        });
    </script>
}
